import { Component, ComponentWillLoad, h, Host, Listen, State } from "@stencil/core"
import { model } from "../../model"

@Component({
	tag: "aron-game",
	styleUrl: "game.css",
	scoped: true,
})
export class AronGame implements ComponentWillLoad {
	@State() game: model.Game = model.Game.create(
		model.Map.load([
			[
				"forest",
				"forest",
				"forest",
				"rock",
				"rock",
				"forest",
				"forest",
				"forest",
				"rock",
				"rock",
				"forest",
				"rock",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"rock",
			],
			[
				"forest",
				"gravel",
				"gravel",
				"gravel",
				"water",
				"water",
				"gravel",
				"forest",
				"rock",
				"forest",
				"grass",
				"gravel",
				"grass",
				"gravel",
				"gravel",
				"grass",
				"forest",
				"rock",
			],
			[
				"forest",
				"gravel",
				"gravel",
				"gravel",
				"water",
				"water",
				"gravel",
				"forest",
				"rock",
				"forest",
				"gravel",
				"grass",
				"gravel",
				"gravel",
				"grass",
				"gravel",
				"forest",
				"rock",
			],
			[
				"rock",
				"gravel",
				"gravel",
				"grass",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"rock",
				"gravel",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"grass",
				"grass",
				"gravel",
				"rock",
			],
			[
				"gravel",
				"gravel",
				"grass",
				"grass",
				"grass",
				"grass",
				"grass",
				"gravel",
				"forest",
				"gravel",
				"grass",
				"grass",
				"grass",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"forest",
			],
			[
				"gravel",
				"gravel",
				"grass",
				"grass",
				"grass",
				"grass",
				"grass",
				"gravel",
				"forest",
				"gravel",
				"grass",
				"grass",
				"grass",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"forest",
			],
			[
				"rock",
				"gravel",
				"gravel",
				"grass",
				"grass",
				"grass",
				"gravel",
				"rock",
				"rock",
				"forest",
				"gravel",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"gravel",
				"rock",
				"rock",
			],
			[
				"rock",
				"gravel",
				"gravel",
				"gravel",
				"grass",
				"gravel",
				"gravel",
				"gravel",
				"forest",
				"forest",
				"gravel",
				"grass",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"gravel",
				"forest",
			],
			[
				"gravel",
				"gravel",
				"gravel",
				"water",
				"water",
				"water",
				"gravel",
				"gravel",
				"gravel",
				"gravel",
				"gravel",
				"water",
				"water",
				"water",
				"gravel",
				"gravel",
				"gravel",
				"forest",
			],
			[
				"gravel",
				"gravel",
				"gravel",
				"water",
				"water",
				"water",
				"gravel",
				"gravel",
				"gravel",
				"gravel",
				"gravel",
				"water",
				"water",
				"water",
				"gravel",
				"gravel",
				"gravel",
				"forest",
			],
			[
				"forest",
				"gravel",
				"gravel",
				"gravel",
				"grass",
				"gravel",
				"gravel",
				"forest",
				"forest",
				"forest",
				"gravel",
				"gravel",
				"water",
				"water",
				"water",
				"gravel",
				"gravel",
				"forest",
			],
			[
				"forest",
				"gravel",
				"gravel",
				"grass",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"forest",
				"forest",
				"gravel",
				"grass",
				"grass",
				"grass",
				"gravel",
				"gravel",
				"gravel",
				"forest",
			],
			[
				"forest",
				"gravel",
				"grass",
				"grass",
				"grass",
				"grass",
				"grass",
				"gravel",
				"forest",
				"forest",
				"grass",
				"grass",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
			],
			[
				"forest",
				"gravel",
				"grass",
				"grass",
				"grass",
				"grass",
				"grass",
				"gravel",
				"forest",
				"forest",
				"grass",
				"grass",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
			],
			[
				"rock",
				"rock",
				"rock",
				"gravel",
				"gravel",
				"gravel",
				"gravel",
				"forest",
				"forest",
				"forest",
				"gravel",
				"gravel",
				"gravel",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
			],
			[
				"rock",
				"rock",
				"rock",
				"gravel",
				"gravel",
				"gravel",
				"gravel",
				"forest",
				"forest",
				"forest",
				"gravel",
				"gravel",
				"gravel",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
			],
			[
				"rock",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
				"forest",
			],
		])
	)
	@Listen("keydown", { target: "window" })
	onKeyDown(event: KeyboardEvent) {
		let direction: model.Direction | undefined
		switch (event.key) {
			case "ArrowLeft":
				direction = "left"
				break
			case "ArrowRight":
				direction = "right"
				break
			case "ArrowUp":
				direction = "up"
				break
			case "ArrowDown":
				direction = "down"
				break
		}
		if (direction)
			this.game = this.game.move(direction)
	}
	componentWillLoad(): void {
		this.game = this.game.setViewport(new model.Size(window.innerWidth, window.innerHeight))
	}
	render() {
		return (
			<Host>
				<aron-layer layer="ground" map={this.game.map} scope={this.game.scope}></aron-layer>
				<aron-hero hero={this.game.hero} scope={this.game.scope}></aron-hero>
				<aron-layer layer="canopy" map={this.game.map} scope={this.game.scope}></aron-layer>
			</Host>
		)
	}
}
